import{_ as W}from"./AppLayout.vue_vue_type_script_setup_true_lang-BtxoXEAO.js";import{_ as z}from"./PageContainer.vue_vue_type_script_setup_true_lang-BEBW8e7I.js";import{v as m,_ as G}from"./RestaurantTable.vue_vue_type_script_setup_true_lang-BItjwm7X.js";import{U as J}from"./Konva-DDdcyEhf.js";import{d as S,L as x,r as _,G as P,j as Q,x as Z,q as C,e as A,o as p,a as c,t as ee,b as k,w as R,c as O,f as te,F as ae,h as ne}from"./app-DmiFfQ2G.js";import"./SecondaryButton.vue_vue_type_script_setup_true_lang-CqX5B3hd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextLink.vue_vue_type_script_setup_true_lang-_a-QFXiR.js";const se={class:"mb-4 space-x-2"},ie={class:"text-xs"},re={id:"container"},oe=S({__name:"Restaurant",setup(q){const y={"square-4":{shape:"rect",width:200,height:200,chairPositions:[{x:0,y:.5,angle:0},{x:.5,y:0,angle:90},{x:1,y:.5,angle:180},{x:.5,y:1,angle:270}]},"square-6":{shape:"rect",width:200,height:100,chairPositions:[{x:0,y:.5,angle:0},{x:.33,y:0,angle:90},{x:.66,y:0,angle:90},{x:1,y:.5,angle:180},{x:.33,y:1,angle:270},{x:.66,y:1,angle:270}]},"circle-4":{shape:"circle",radius:120,chairPositions:[{x:0,y:.5,angle:0},{x:.5,y:0,angle:90},{x:1,y:.5,angle:180},{x:.5,y:1,angle:270}]}},T=x("stageRef"),N=x("layerRef"),g=x("my-tables"),j=_(null),r=_([]),l=P({changes:[],redoStack:[]}),u=_(null),$=P({width:500,height:500,scaleX:.3,scaleY:.3});Q(()=>r.value.find(e=>e.id===u.value));const D={tables:[{shape:"circle-4",x:800,y:800},{shape:"square-4",x:800,y:300},{shape:"square-4",x:300,y:800},{shape:"square-6",x:1300,y:800},{shape:"square-4",x:800,y:1300}]};function E(e,t,a){const s=m(),n=y[e],i=n.chairPositions.map(d=>{const o=n.shape==="rect"?n.width+60:n.radius*2+60,f=n.shape==="rect"?n.height+60:n.radius*2+60,h={x:-o/2,y:-f/2,width:o,height:f},b=h.x+h.width*d.x,H=h.y+h.height*d.y;return{id:m(),position:{x:b,y:H},angle:d.angle,visible:!0,parentId:s}});return{id:s,position:{x:t,y:a},rotation:0,diet:"Omnivore",tableType:e,focus:!1,chairs:i}}function V(){r.value=D.tables.map(e=>E(e.shape,e.x,e.y))}function w(e){l.changes.push(e),l.redoStack=[];const{obj:t,after:a}=e;if(t.type==="table"){const s=r.value.find(n=>n.id===t.id);s&&Object.assign(s,a)}else if(t.type==="chair")for(const s of r.value){const n=s.chairs.find(i=>i.id===t.id);if(n){Object.assign(n,a);break}}}function B(){if(l.changes.length===0)return;const e=l.changes.pop();l.redoStack.push(e);const{obj:t,before:a}=e;if(t.type==="table"){const s=r.value.find(n=>n.id===t.id);s&&Object.assign(s,a)}else if(t.type==="chair")for(const s of r.value){const n=s.chairs.find(i=>i.id===t.id);if(n){Object.assign(n,a);break}}}function F(){if(l.redoStack.length===0)return;const e=l.redoStack.pop();l.changes.push(e);const{obj:t,after:a}=e;if(t.type==="table"){const s=r.value.find(n=>n.id===t.id);s&&Object.assign(s,a)}else if(t.type==="chair")for(const s of r.value){const n=s.chairs.find(i=>i.id===t.id);if(n){Object.assign(n,a);break}}}function M(e){if(r.value.forEach(t=>{t.focus=t.id===e}),u.value=e,g.value){const a=(Array.isArray(g.value)?g.value:[g.value]).find(s=>s.id===e);a&&(j.value=a.getKonvaNode())}}function U(e){e.target.getClassName()==="Stage"&&(r.value.forEach(t=>{t.focus=!1}),u.value=null)}function I(){if(!u.value)return;const e=r.value.find(f=>f.id===u.value);if(!e)return;if(e.tableType.indexOf("circle")!==0){alert("Can only add chairs to circle tables!");return}const s=360/(e.chairs.filter(f=>f.visible).length+1),d=y[e.tableType].radius+60,o={id:m(),position:{x:0,y:-d},angle:s,visible:!0,parentId:e.id};e.chairs.push(o),w({obj:{type:"chair",id:o.id},before:{visible:!1},after:{visible:!0}}),K(e)}function K(e){if(e.tableType.indexOf("circle")!==0)return;const t=e.chairs.filter(o=>o.visible),s=360/t.length,d=y[e.tableType].radius+60;t.forEach((o,f)=>{const h=s*f,b=h*(Math.PI/180);o.position={x:Math.sin(b)*d,y:-Math.cos(b)*d},o.angle=h+90})}function v(e){if(!u.value)return;const t=r.value.find(a=>a.id===u.value);t&&w({obj:{type:"table",id:t.id},before:{diet:t.diet},after:{diet:e}})}function L(e,t){e&&Y(e,t)&&alert("Tables may not overlap!")}function X(e){return(Array.isArray(g.value)?g.value:[g.value]).filter(a=>a.id!==e).map(a=>a.getKonvaNode().getClientRect()).filter(a=>a!==null)}function Y(e,t){let a=!1;const s=e.getClientRect(),n=X(t);for(const i of n)if(J.hasOverlap(s,i)){a=!0;break}return a}return Z(()=>{V()}),(e,t)=>{const a=C("v-transformer"),s=C("v-layer"),n=C("v-stage");return p(),A("div",null,[c("div",se,[c("button",{class:"rounded-lg border border-gray-500 bg-gray-200 px-2 py-1 text-sm",onClick:B}," Undo "),c("button",{class:"rounded-lg border border-gray-500 bg-gray-200 px-2 py-1 text-sm",onClick:F}," Redo "),c("button",{class:"rounded-lg border border-gray-500 bg-gray-200 px-2 py-1 text-sm",onClick:I}," Add Chair "),c("button",{class:"rounded-lg border border-gray-500 bg-gray-200 px-2 py-1 text-sm",onClick:t[0]||(t[0]=i=>v("Vegetarian"))}," Vegetarian "),c("button",{class:"rounded-lg border border-gray-500 bg-gray-200 px-2 py-1 text-sm",onClick:t[1]||(t[1]=i=>v("Pescatarian"))}," Pescatarian "),c("button",{class:"rounded-lg border border-gray-500 bg-gray-200 px-2 py-1 text-sm",onClick:t[2]||(t[2]=i=>v("Omnivore"))}," Omnivore ")]),c("div",null,[c("pre",ie,"                "+ee(l.changes)+`
            `,1)]),c("div",re,[k(n,{ref_key:"stageRef",ref:T,config:$,onClick:U},{default:R(()=>[k(s,{ref_key:"layerRef",ref:N},{default:R(()=>[(p(!0),A(ae,null,ne(r.value,i=>(p(),O(G,{id:i.id,ref_for:!0,ref:"my-tables",key:i.id,position:i.position,rotation:i.rotation,diet:i.diet,focus:i.focus,"table-type":i.tableType,chairs:i.chairs,onFocus:M,onDragend:L},null,8,["id","position","rotation","diet","focus","table-type","chairs"]))),128)),u.value?(p(),O(a,{key:0,config:{nodes:[j.value],padding:5,enabledAnchors:[],rotateAnchorOffset:20}},null,8,["config"])):te("",!0)]),_:1},512)]),_:1},8,["config"])])])}}}),ye=S({layout:W,__name:"RestaurantPage",setup(q){return(y,T)=>(p(),O(z,{title:"Restaurant","show-footer":!1},{default:R(()=>[k(oe)]),_:1}))}});export{ye as default};
