import{e as W,o as _,d as Q,q as Ce,C as Fe,a as n,i as He,k as M,u as v,s as Y,x as Ee,b as c,w as L,g as Ve,r as y,y as Z,j as d,z as Ne,A as Ue,B as Ge,D,t as X,c as he,F as J,h as ve,E as Ie}from"./app-BcwI-xJi.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as je}from"./PrimaryButton.vue_vue_type_script_setup_true_lang-DDOSM63m.js";import{_ as Oe}from"./AppLayout.vue_vue_type_script_setup_true_lang-BLUKpME3.js";import{_ as Re}from"./PageContainer.vue_vue_type_script_setup_true_lang-BtWe46ik.js";import"./SecondaryButton.vue_vue_type_script_setup_true_lang-BIgngevG.js";import"./TextLink.vue_vue_type_script_setup_true_lang-Bvd9SL6h.js";const Ke={};function qe(m,r){return _(),W("div",null,"Add Bed")}const Ze=ie(Ke,[["render",qe]]),Je={};function Qe(m,r){return _(),W("div",null,"Add Plant")}const et=ie(Je,[["render",Qe]]),tt={class:"space-y-3 p-2 text-sm text-black"},lt={class:"space-y-1"},nt={class:"space-y-1"},at={class:"space-y-1"},ot={class:"space-y-1"},it={class:"space-y-1"},ut={class:"w-full pt-6"},st=Q({__name:"MenuSettings",setup(m){const r=Ce("plots"),l=Fe({...r,location_combined:`${r.location_name} (${r.location_lat}, ${r.location_lng})`});function h(){const b=l.location_combined.match(/^([A-Z\s\-(),.']+)\s\((-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)\)/i);if(b){const[u,g,ee,te]=b;l.location_name=g,l.location_lat=Number(ee),l.location_lng=Number(te)}}function z(){h(),l.put(`plots/${r.id}`)}return(b,u)=>(_(),W("div",null,[u[15]||(u[15]=n("h2",{class:"bg-green-200 p-2 text-lg tracking-wide text-green-800"}," Plot Settings ",-1)),n("form",{onSubmit:He(z,["prevent"])},[n("div",tt,[n("div",lt,[u[8]||(u[8]=n("label",{class:"text-xs font-semibold uppercase tracking-wide"},"Name:",-1)),M(n("input",{"onUpdate:modelValue":u[0]||(u[0]=g=>v(l).name=g),class:"w-full rounded border border-gray-300 bg-white",type:"text"},null,512),[[Y,v(l).name]])]),n("div",nt,[u[9]||(u[9]=n("label",{class:"text-xs font-semibold uppercase tracking-wide"},"Width:",-1)),M(n("input",{"onUpdate:modelValue":u[1]||(u[1]=g=>v(l).width=g),class:"w-full rounded border border-gray-300 bg-white",type:"number",step:"any"},null,512),[[Y,v(l).width]])]),n("div",at,[u[10]||(u[10]=n("label",{class:"text-xs font-semibold uppercase tracking-wide"},"Length:",-1)),M(n("input",{"onUpdate:modelValue":u[2]||(u[2]=g=>v(l).length=g),class:"w-full rounded border border-gray-300 bg-white",type:"number",step:"any"},null,512),[[Y,v(l).length]])]),n("div",ot,[u[11]||(u[11]=n("label",{class:"text-xs font-semibold uppercase tracking-wide"},"Location:",-1)),M(n("input",{"onUpdate:modelValue":u[3]||(u[3]=g=>v(l).location_lat=g),class:"w-full rounded border border-gray-300 bg-white",type:"hidden"},null,512),[[Y,v(l).location_lat]]),M(n("input",{"onUpdate:modelValue":u[4]||(u[4]=g=>v(l).location_lng=g),class:"w-full rounded border border-gray-300 bg-white",type:"hidden"},null,512),[[Y,v(l).location_lng]]),M(n("input",{"onUpdate:modelValue":u[5]||(u[5]=g=>v(l).location_name=g),class:"w-full rounded border border-gray-300 bg-white",type:"hidden"},null,512),[[Y,v(l).location_name]]),M(n("input",{"onUpdate:modelValue":u[6]||(u[6]=g=>v(l).location_combined=g),class:"w-full rounded border border-gray-300 bg-white",type:"text"},null,512),[[Y,v(l).location_combined]])]),n("div",it,[u[13]||(u[13]=n("label",{class:"text-xs font-semibold uppercase tracking-wide"},"Preferred unit of measure:",-1)),M(n("select",{"onUpdate:modelValue":u[7]||(u[7]=g=>v(l).units=g),class:"w-full rounded border border-gray-300 bg-white"},u[12]||(u[12]=[n("option",{value:"metres"}," Metres ",-1),n("option",{value:"yards"}," Yards ",-1)]),512),[[Ee,v(l).units]])]),n("div",ut,[c(je,{type:"submit"},{default:L(()=>u[14]||(u[14]=[Ve(" Update ")])),_:1})])])],32)]))}}),rt={};function ct(m,r){return _(),W("div",null,"Add Structure")}const dt=ie(rt,[["render",ct]]),vt={class:"flex flex-col"},ht={class:"flex justify-between"},gt=Q({__name:"SidePanel",setup(m){const r=y("MenuSettings");return(l,h)=>(_(),W("div",vt,[n("div",ht,[n("a",{href:"#",onClick:h[0]||(h[0]=z=>r.value="MenuStructure")},h[4]||(h[4]=[n("img",{id:"structureMenuButton",alt:"Activate Structures Layer & show Add Structures menu",class:"size-12",src:"/images/newstructure.png",title:"Activate Structures Layer & show Add Structures menu"},null,-1)])),n("a",{href:"#",onClick:h[1]||(h[1]=z=>r.value="MenuBed")},h[5]||(h[5]=[n("img",{id:"bedMenuButton",alt:"Activate Beds Layer & show Add Beds menu",class:"size-12",src:"/images/newbed.png",title:"Activate Beds Layer & show Add Beds menu"},null,-1)])),n("a",{href:"#",onClick:h[2]||(h[2]=z=>r.value="MenuPlant")},h[6]||(h[6]=[n("img",{id:"plantMenuButton",alt:"Activate Plants Layer & show Add plants menu",class:"size-12",src:"/images/newplant.png",title:"Activate Plants Layer & show Add plants menu"},null,-1)])),n("a",{href:"#",onClick:h[3]||(h[3]=z=>r.value="MenuSettings")},h[7]||(h[7]=[n("img",{id:"plotMenuButton",alt:"Show Plot Settings menu",class:"size-12",src:"/images/cogicon.png",title:"Show Plot Settings menu"},null,-1)]))]),n("div",null,[M(c(dt,null,null,512),[[Z,r.value==="MenuStructure"]]),M(c(Ze,null,null,512),[[Z,r.value==="MenuBed"]]),M(c(et,null,null,512),[[Z,r.value==="MenuPlant"]]),M(c(st,null,null,512),[[Z,r.value==="MenuSettings"]])])]))}}),ft={class:"h-[50px] space-x-2 bg-gray-300 p-2 text-xs"},mt={class:"flex"},pt={class:"w-full"},xt=Q({__name:"VegPlot",props:{plots:{},plotConfig:{}},setup(m){const{SCROLLBAR_SIZE:r=12,UNIT_PIXELS:l=100,SIDEPANEL_WIDTH:h=220,VERTICAL_OFFSET:z=116,PADDING_PIXELS:b=50}=m.plotConfig||{},u=y(0),g=y(null),ee=y(null),te=y(null),ge=y(null),f=y(1),a=y({width:window.innerWidth-h,height:window.innerHeight-z}),p=y(0),x=y(0),le=y(!1),fe=y(null),me=y(null),G=d(()=>{const e=T(a.value.width)-b*2;return m.plots.width*l<=e}),I=d(()=>{const e=T(a.value.height)-b*2;return m.plots.length*l<=e}),E=d(()=>{const e=T(a.value.width),o=m.plots.width*l;if(G.value){const t=(e-o)/2;return f.value>1?t<b?t:Math.max(b,t):t}return b}),V=d(()=>{const e=T(a.value.height),o=m.plots.length*l;if(I.value){const t=(e-o)/2;return f.value>1?t<b?t:Math.max(b,t):t}return b}),P=d(()=>({x:E.value,y:V.value,width:m.plots.width*l,height:m.plots.length*l,fill:"#eee",stroke:"black"})),S=d(()=>{const e=a.value.width,t=P.value.width+E.value*2;return G.value?Math.max(t,T(e)):t}),k=d(()=>{const e=a.value.height,t=P.value.height+V.value*2;return I.value?Math.max(t,T(e)):t}),j=d(()=>S.value*f.value),O=d(()=>k.value*f.value),R=d(()=>Math.min(0,a.value.width-j.value)),K=d(()=>Math.min(0,a.value.height-O.value)),pe=d(()=>({x:p.value,y:x.value,width:S.value,height:k.value,scaleX:f.value,scaleY:f.value,draggable:!0,dragBoundFunc:e=>{const o=Math.max(R.value,Math.min(0,e.x)),t=Math.max(K.value,Math.min(0,e.y));return{x:o,y:t}}})),C=d(()=>Math.floor(O.value)>a.value.height),N=d(()=>C.value?Math.max(20,a.value.height/O.value*a.value.height):0),F=d(()=>Math.floor(j.value)>a.value.width),U=d(()=>F.value?Math.max(20,a.value.width/j.value*a.value.width):0),xe=d(()=>{if(!C.value)return 0;const e=-x.value,o=O.value-a.value.height,t=e/o*(a.value.height-N.value);return Math.max(0,Math.min(a.value.height-N.value,t))}),we=d(()=>{if(!F.value)return 0;const e=-p.value,o=j.value-a.value.width,t=e/o*(a.value.width-U.value);return Math.max(0,Math.min(a.value.width-U.value,t))}),ye=d(()=>{const e=[],o=P.value.x*f.value,t=P.value.width,i=Math.ceil(t/l)+1;for(let s=0;s<i;s++)e.push({x:o+s*l*f.value,text:`${s}m`});return e}),be=d(()=>{const e=[],o=P.value.y*f.value,t=P.value.height,i=Math.ceil(t/l)+1;for(let s=0;s<i;s++)e.push({y:o+s*l*f.value,text:`${s}m`});return e}),ne=[5,4,3,2.5,2,1.5,1,.9,.8,.7,.6,.5,.4,.3,.2,.1,.05];let q=ne.indexOf(f.value);function T(e){return e/f.value}function Me(e){p.value=e.target.x(),x.value=e.target.y()}function ue(e,o){const t=f.value,i=g.value.getNode().getPointerPosition();if(!i)return;const s={x:i.x-g.value.getNode().x(),y:i.y-g.value.getNode().y()},$={x:(s.x-p.value)/t,y:(s.y-x.value)/t};let A;if(e&&e.evt instanceof WheelEvent?A=e.evt.deltaY>0?-1:1:A=o>1?1:-1,A<0&&G.value&&I.value)return;q=A>0?Math.max(0,q-1):Math.min(ne.length-1,q+1);const B=ne[q];f.value=B,p.value=s.x-$.x*B,x.value=s.y-$.y*B;const ae=Math.min(0,a.value.width-S.value*B),w=Math.min(0,a.value.height-k.value*B);p.value=Math.max(ae,Math.min(0,p.value)),x.value=Math.max(w,Math.min(0,x.value))}function _e(e){const o=-e.evt.deltaX,t=-e.evt.deltaY;if(F.value){const i=p.value+o;p.value=Math.max(R.value,Math.min(0,i))}if(C.value){const i=x.value+t;x.value=Math.max(K.value,Math.min(0,i))}}function Se(e){if(e.evt.preventDefault(),le.value){ue(e);return}(F.value||C.value)&&_e(e)}const ke=d(()=>f.value>=1?S.value:T(S.value)),$e=d(()=>f.value>=1?k.value:T(k.value));function Le(){p.value=F.value?Math.max(R.value,0):0,x.value=C.value?Math.max(K.value,0):0}const We=d(()=>{let e="";const o=V.value%l,t=Math.ceil(k.value/l);for(let i=0;i<t;i++){const s=o+i*l;e+=`M 0 ${s} L ${S.value} ${s} 
`}return{data:e,stroke:"gray",strokeWidth:.5}}),Pe=d(()=>{let e="";const o=V.value%(l/10),t=Math.ceil(k.value/l)*10;for(let i=0;i<t;i++){const s=o+i*l/10;e+=`M 0 ${s} L ${S.value} ${s} 
`}return{data:e,stroke:"gray",strokeWidth:.2}}),Ae=d(()=>{let e="";const o=E.value%l,t=Math.ceil(S.value/l);for(let i=0;i<t;i++){const s=o+i*l;e+=`M ${s} 0 L ${s} ${k.value} `}return{data:e,stroke:"gray",strokeWidth:.5}}),ze=d(()=>{let e="";const o=E.value%(l/10),t=Math.ceil(S.value/l)*10;for(let i=0;i<t;i++){const s=o+i*l/10;e+=`M ${s} 0 L ${s} ${k.value} `}return{data:e,stroke:"gray",strokeWidth:.2}});Ne([()=>m.plots.length,()=>m.plots.width,()=>a.value.height,()=>a.value.width],Le,{immediate:!0});function Te(e){const o=e.target.y(),t=a.value.height-N.value,i=o/t,s=k.value*f.value-a.value.height,$=i*s;x.value=-$}function Be(e){const o=e.target.x(),t=a.value.width-U.value,i=o/t,s=S.value*f.value-a.value.width,$=i*s;p.value=-$}let H=0;function Xe(e){e.evt.touches.length>=2&&(H=se(e.evt.touches))}function Ye(e){if(e.evt.touches.length>=2){e.evt.preventDefault();const o=se(e.evt.touches);H===0&&(H=o);const t=o/H;ue(e,t),H=o}}function De(){H=0}function se(e){const o=e[0],t=e[1];return Math.sqrt((t.clientX-o.clientX)**2+(t.clientY-o.clientY)**2)}function re(){a.value.width=window.innerWidth-h,a.value.height=window.innerHeight-z}function ce(e){e.key==="Control"&&(le.value=!0)}function de(e){e.key==="Control"&&(le.value=!1)}return Ue(()=>{window.addEventListener("resize",re),window.addEventListener("keydown",ce),window.addEventListener("keyup",de)}),Ge(()=>{window.removeEventListener("resize",re),window.removeEventListener("keydown",ce),window.removeEventListener("keyup",de)}),(e,o)=>{const t=D("v-rect"),i=D("v-path"),s=D("v-group"),$=D("v-layer"),A=D("v-line"),B=D("v-text"),ae=D("v-stage");return _(),W("div",null,[n("p",ft,[n("span",null,"Scale: "+X(f.value),1),n("span",null,"stage: "+X(`(${a.value.width}, ${a.value.height})`),1),n("span",null,"fitsOnStageX: "+X(`(${G.value}, ${I.value})`),1),n("span",null,"padding: "+X(`(${E.value.toFixed(0)}, ${V.value.toFixed(0)})`),1),n("span",null,"min: "+X(`(${R.value.toFixed(0)}, ${K.value.toFixed(0)})`),1),n("span",null,"gridWidth: "+X(`(${S.value.toFixed(0)}, ${k.value.toFixed(0)})`),1),n("span",null,"gridWidth: "+X(`(${P.value.x.toFixed(0)}, ${P.value.y.toFixed(0)})`),1),n("span",null,"gridConfigXY: "+X(`(${p.value.toFixed(0)}, ${x.value.toFixed(0)})`),1)]),n("div",mt,[n("div",null,[(_(),he(ae,{ref_key:"stage",ref:g,key:u.value,config:a.value,onWheel:Se,onTouchstart:Xe,onTouchmove:Ye,onTouchend:De},{default:L(()=>[c($,{ref_key:"background",ref:ee,name:"background"},{default:L(()=>[c(s,{id:"grid-group",ref_key:"grid",ref:te,name:"grid",config:pe.value,onDragmove:Me},{default:L(()=>[c(t,{name:"grid-background",config:{x:0,y:0,width:ke.value,height:$e.value,fill:"#abb"}},null,8,["config"]),c(t,{name:"plot-area",config:P.value},null,8,["config"]),c(i,{config:Pe.value},null,8,["config"]),c(i,{config:We.value},null,8,["config"]),c(i,{config:ze.value},null,8,["config"]),c(i,{config:Ae.value},null,8,["config"])]),_:1},8,["config"])]),_:1},512),c($,{ref_key:"axesLayer",ref:ge,name:"axes",config:{visible:!0}},{default:L(()=>[c(A,{name:"x-axis",config:{x:0,y:10,points:[0,0,a.value.width,0],stroke:"black",strokeWidth:20,opacity:.5}},null,8,["config"]),c(A,{name:"y-axis",config:{x:10,y:0,points:[0,0,0,a.value.height],stroke:"black",strokeWidth:20,opacity:.5}},null,8,["config"]),c(s,{config:{x:p.value}},{default:L(()=>[(_(!0),W(J,null,ve(ye.value,(w,oe)=>(_(),W(J,{key:`x-tick-${oe}`},[c(A,{config:{x:w.x,y:15,points:[0,0,0,5],stroke:"white",strokeWidth:1}},null,8,["config"]),c(B,{config:{x:w.x-7,y:3,text:w.text,fontSize:10,fill:"white",align:"center"}},null,8,["config"])],64))),128))]),_:1},8,["config"]),c(s,{config:{y:x.value}},{default:L(()=>[(_(!0),W(J,null,ve(be.value,(w,oe)=>(_(),W(J,{key:`y-tick-${oe}`},[c(A,{config:{x:15,y:w.y,points:[0,0,5,0],stroke:"white",strokeWidth:1}},null,8,["config"]),c(B,{config:{x:3,y:w.y+7,text:w.text,fontSize:10,rotation:270,fill:"white",align:"left"}},null,8,["config"])],64))),128))]),_:1},8,["config"])]),_:1},512),c($,{visible:C.value,name:"verticalScrollbarLayer"},{default:L(()=>[c(t,{config:{x:a.value.width-v(r)-2,y:0,width:v(r)+2,height:a.value.height,fill:"#eee"}},null,8,["config"]),c(t,{ref_key:"verticalScrollbar",ref:fe,config:{x:a.value.width-v(r),y:xe.value,width:v(r),height:N.value,fill:"#aaa",draggable:!0,dragBoundFunc:w=>({x:a.value.width-v(r),y:Math.max(0,Math.min(a.value.height-N.value,w.y))}),stroke:"#999",strokeWidth:1},onDragmove:Te},null,8,["config"])]),_:1},8,["visible"]),c($,{visible:F.value,name:"horizontalScrollbarLayer"},{default:L(()=>[c(t,{config:{x:0,y:a.value.height-v(r)-2,width:a.value.width,height:v(r)+2,fill:"#eee"}},null,8,["config"]),c(t,{ref_key:"horizontalScrollbar",ref:me,config:{x:we.value,y:a.value.height-v(r),width:U.value,height:v(r),fill:"#aaa",draggable:!0,dragBoundFunc:w=>({x:Math.max(0,Math.min(a.value.width-U.value,w.x)),y:a.value.height-v(r)}),stroke:"#999",strokeWidth:1},onDragmove:Be},null,8,["config"])]),_:1},8,["visible"])]),_:1},8,["config"]))]),n("div",pt,[c(gt)])])])}}}),$t=Q({layout:Oe,__name:"PlotPage",props:{plots:{}},setup(m){const r=m;return Ie("plots",r.plots),(l,h)=>(_(),he(Re,{title:"Plot","show-footer":!1},{default:L(()=>[c(xt,{plots:r.plots},null,8,["plots"])]),_:1}))}});export{$t as default};
