import{_ as V}from"./AppLayout.vue_vue_type_script_setup_true_lang-BtxoXEAO.js";import{_ as X}from"./PageContainer.vue_vue_type_script_setup_true_lang-BEBW8e7I.js";import{d as _,r as m,x as $,K as u,e as I,o as z,a as d,g as T,t as q,F as O,c as Y,w as j,b as A}from"./app-DmiFfQ2G.js";import"./SecondaryButton.vue_vue_type_script_setup_true_lang-CqX5B3hd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextLink.vue_vue_type_script_setup_true_lang-_a-QFXiR.js";const H={id:"scaleDisplay"},J=["checked"],Q=["checked"],Z=["checked"],ee=["checked"],k=800,b=400,s=40,te=_({__name:"KonvaGrid",setup(D){const n=m(null),a=m(null),p=m(null),g=m("solution1"),M=m(1),W=[5,4,3,2.5,2,1.5,1,.9,.8,.7,.6,.5,.4,.3,.2,.1,.05];let x=6;$(()=>{n.value=new u.Stage({container:"container",width:k,height:b,draggable:!0}),a.value=new u.Layer({draggable:!1,x:0,y:0}),n.value.add(a.value),p.value=new u.Layer,n.value.add(p.value);const t=new u.Rect({x:2,y:2,width:k-4,height:b-4,strokeWidth:4,stroke:"green"}),e=new u.Rect({x:2,y:2,width:k-4,height:b-4,fill:"yellow",opacity:.2});p.value.add(e,t);const i=new u.Rect({x:0,y:0,width:40,height:40,fill:"blue",draggable:!0});p.value.add(i);const y=new u.Circle({x:n.value.width()/2,y:n.value.height()/2,radius:50,fill:"orange",draggable:!0});p.value.add(y),S(),n.value.on("wheel",U),n.value.on("dragend",S)});let c,o,h,f,w,R;function S(){if(!(!a.value||!n.value))switch(a.value.clear(),a.value.destroyChildren(),a.value.clipWidth(null),c={x1:0,y1:0,x2:n.value.width(),y2:n.value.height(),offset:{x:v(n.value.position().x),y:v(n.value.position().y)}},o={x1:-c.offset.x,y1:-c.offset.y,x2:v(k)-c.offset.x,y2:v(b)-c.offset.y},h={x1:Math.min(c.x1,o.x1),y1:Math.min(c.y1,o.y1),x2:Math.max(c.x2,o.x2),y2:Math.max(c.y2,o.y2)},f={x:Math.ceil(v(n.value.position().x)/s)*s,y:Math.ceil(v(n.value.position().y)/s)*s},w={x1:-f.x,y1:-f.y,x2:v(k)-f.x+s,y2:v(b)-f.y+s},R={x1:Math.min(c.x1,w.x1),y1:Math.min(c.y1,w.y1),x2:Math.max(c.x2,w.x2),y2:Math.max(c.y2,w.y2)},g.value){case"solution1":K();break;case"solution2":N();break;case"solution3":B();break;case"solution4":P();break}}function v(t){return t/n.value.scaleX()}function K(){const t=n.value.width(),e=n.value.height(),i=Math.round(t/s),y=Math.round(e/s);for(let l=0;l<=i;l++)a.value.add(new u.Line({x:l*s,points:[0,0,0,e],stroke:"rgba(0, 0, 0, 0.2)",strokeWidth:1}));for(let l=0;l<=y;l++)a.value.add(new u.Line({y:l*s,points:[0,0,t,0],stroke:"rgba(0, 0, 0, 0.2)",strokeWidth:1}));a.value.add(new u.Rect({x:o.x1+2,y:o.y1+2,width:o.x2-o.x1-4,height:o.y2-o.y1-4,strokeWidth:4,stroke:"red"})),a.value.batchDraw()}function N(){const t=h.x2-h.x1,e=h.y2-h.y1,i=Math.round(t/s),y=Math.round(e/s);for(let l=0;l<=i;l++)a.value.add(new u.Line({x:h.x1+l*s,y:h.y1,points:[0,0,0,e],stroke:"rgba(0, 0, 0, 0.2)",strokeWidth:1}));for(let l=0;l<=y;l++)a.value.add(new u.Line({x:h.x1,y:h.y1+l*s,points:[0,0,t,0],stroke:"rgba(0, 0, 0, 0.2)",strokeWidth:1}));a.value.add(new u.Rect({x:o.x1+2,y:o.y1+2,width:o.x2-o.x1-4,height:o.y2-o.y1-4,strokeWidth:4,stroke:"red"})),a.value.batchDraw()}function B(){const t=R,e=t.x2-t.x1,i=t.y2-t.y1,y=Math.round(e/s),l=Math.round(i/s);for(let r=0;r<=y;r++)a.value.add(new u.Line({x:t.x1+r*s,y:t.y1,points:[0,0,0,i],stroke:"rgba(0, 0, 0, 0.2)",strokeWidth:1}));for(let r=0;r<=l;r++)a.value.add(new u.Line({x:t.x1,y:t.y1+r*s,points:[0,0,e,0],stroke:"rgba(0, 0, 0, 0.2)",strokeWidth:1}));a.value.add(new u.Rect({x:o.x1+2,y:o.y1+2,width:o.x2-o.x1-4,height:o.y2-o.y1-4,strokeWidth:4,stroke:"red"})),a.value.batchDraw()}function P(){a.value.clip({x:o.x1,y:o.y1,width:o.x2-o.x1,height:o.y2-o.y1});const t=R,e=t.x2-t.x1,i=t.y2-t.y1,y=Math.round(e/s),l=Math.round(i/s);for(let r=0;r<=y;r++)a.value.add(new u.Line({x:t.x1+r*s,y:t.y1,points:[0,0,0,i],stroke:"rgba(0, 0, 0, 0.2)",strokeWidth:1}));for(let r=0;r<=l;r++)a.value.add(new u.Line({x:t.x1,y:t.y1+r*s,points:[0,0,e,0],stroke:"rgba(0, 0, 0, 0.2)",strokeWidth:1}));a.value.add(new u.Rect({x:o.x1+2,y:o.y1+2,width:o.x2-o.x1-4,height:o.y2-o.y1-4,strokeWidth:4,stroke:"red"})),a.value.batchDraw()}function U(t){t.evt.preventDefault();const e=n.value.scaleX(),i=n.value.getPointerPosition(),y={x:(i.x-n.value.x())/e,y:(i.y-n.value.y())/e};let l=t.evt.deltaY>0?1:-1;t.evt.ctrlKey&&(l=-l),l>0?x=x>0?x-1:x:x=x<W.length-1?x+1:x;const r=W[x];n.value.scale({x:r,y:r});const G={x:i.x-y.x*r,y:i.y-y.y*r};n.value.position(G),M.value=n.value.scaleX(),n.value.draw(),S()}function F(){const t=n.value.toDataURL();C(t,"stage.png")}function E(){const t=n.value.toDataURL({x:-200,y:-200,width:1200,height:800});C(t,"stage.png")}function C(t,e){const i=document.createElement("a");i.download=e,i.href=t,document.body.appendChild(i),i.click(),document.body.removeChild(i)}function L(t){const e=t.target;g.value=e.value,S()}return(t,e)=>(z(),I(O,null,[e[8]||(e[8]=d("p",null,"Select a solution in sequence, use mouse wheel to zoom in and out",-1)),e[9]||(e[9]=d("p",null,"Red box is the viewport (initial stage size), blue is Konva Stage.",-1)),d("p",null,[e[0]||(e[0]=T("Scale: ")),d("span",H,q(M.value),1)]),d("p",null,[d("input",{id:"solution1",type:"radio",class:"mr-1",name:"solutionNo",value:"solution1",checked:g.value==="solution1",onChange:L},null,40,J),e[1]||(e[1]=d("label",{for:"solution1"},"Solution 1 - grid on stage",-1)),e[2]||(e[2]=d("br",null,null,-1)),d("input",{id:"solution2",type:"radio",class:"mr-1",name:"solutionNo",value:"solution2",checked:g.value==="solution2",onChange:L},null,40,Q),e[3]||(e[3]=d("label",{for:"solution2"},"Solution 2 - grid on merged",-1)),e[4]||(e[4]=d("br",null,null,-1)),d("input",{id:"solution3",type:"radio",class:"mr-1",name:"solutionNo",value:"solution3",checked:g.value==="solution3",onChange:L},null,40,Z),e[5]||(e[5]=d("label",{for:"solution3"},"Solution 3 - grid on merged inc fix for dancing grid effect",-1)),e[6]||(e[6]=d("br",null,null,-1)),d("input",{id:"solution4",type:"radio",class:"mr-1",name:"solutionNo",value:"solution4",checked:g.value==="solution4",onChange:L},null,40,ee),e[7]||(e[7]=d("label",{for:"solution4"},"Solution 4 - optimised drawing via clip function",-1))]),d("p",{id:"buttons",class:"mt-2 space-x-2"},[d("button",{class:"rounded border border-gray-300 bg-gray-200 px-4 py-1 hover:bg-gray-300",onClick:F}," Save viewport image "),d("button",{class:"rounded border border-gray-300 bg-gray-200 px-4 py-1 hover:bg-gray-300",onClick:E}," Save viewport plus 200px around ")])],64))}}),re=_({layout:V,__name:"KonvaGridPage",setup(D){return(n,a)=>(z(),Y(X,{title:"KonvaGrid","show-footer":!1},{default:j(()=>[A(te)]),_:1}))}});export{re as default};
